# é›¨å¤©ä¿¡ç®± - The RainMail

ä¸€ä¸ªåŸºäºå¤©æ°”çŠ¶æ€çš„åŒ¿åç¤¾äº¤æ ‘æ´åº”ç”¨ï¼Œå½“å¹¿å·åŸå¸‚ä¸‹é›¨æ—¶è§£é”æ‰€æœ‰ç§˜å¯†ã€‚

## ğŸŒŸ ç‰¹æ€§

- **å¤©æ°”æ„Ÿåº”**ï¼šè‡ªåŠ¨æ£€æµ‹å®æ—¶å¤©æ°”çŠ¶æ€
- **çŠ¶æ€åˆ‡æ¢**ï¼šæ™´å¤©åªèƒ½æŠ•é€’ï¼Œé›¨å¤©å¯ä»¥æŸ¥çœ‹æ‰€æœ‰ç§˜å¯†
- **æ¯›ç»ç’ƒè®¾è®¡**ï¼šèµ›åšç¦…æ„é£æ ¼çš„ç°ä»£åŒ–UI
- **å®‰å…¨åŒ¿å**ï¼šXSSé˜²æŠ¤å’Œå†…å®¹è¿‡æ»¤
- **åˆ†äº«åŠŸèƒ½**ï¼šç”Ÿæˆç²¾ç¾çš„å­˜ç¥¨å¡ç‰‡
- **å®æ—¶åŒæ­¥**ï¼šWebSocketé£æ ¼çš„å¤©æ°”çŠ¶æ€æ›´æ–°

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Python 3.8+
- pip
- ç½‘ç»œè¿æ¥ï¼ˆç”¨äºå¤©æ°”APIï¼‰

### å®‰è£…è¿è¡Œ

1. **å®‰è£…ä¾èµ–**
   ```bash
   pip install -r requirements.txt
   ```

2. **å¯åŠ¨åº”ç”¨**
   ```bash
   python run.py
   # æˆ–è€…ç›´æ¥è¿è¡Œ
   python app.py
   ```

3. **è®¿é—®åº”ç”¨**
   æ‰“å¼€æµè§ˆå™¨è®¿é—®: http://localhost:5024

### ä½¿ç”¨Dockerè¿è¡Œ

```bash
# æ„å»ºé•œåƒ
docker build -t rainmail .

# è¿è¡Œå®¹å™¨
docker run -p 5024:5000 rainmail
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
rainmail/
â”œâ”€â”€ app.py                 # Flaskä¸»åº”ç”¨
â”œâ”€â”€ run.py                # å¯åŠ¨è„šæœ¬
â”œâ”€â”€ test_app.py           # åŠŸèƒ½æµ‹è¯•
â”œâ”€â”€ config.yaml           # é…ç½®æ–‡ä»¶
â”œâ”€â”€ requirements.txt      # Pythonä¾èµ–
â”œâ”€â”€ rainmail.db           # SQLiteæ•°æ®åº“ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”œâ”€â”€ templates/            # HTMLæ¨¡æ¿
â”‚   â””â”€â”€ index.html
â”œâ”€â”€ static/              # é™æ€èµ„æº
â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â””â”€â”€ style.css
â”‚   â””â”€â”€ js/
â”‚       â””â”€â”€ app.js
â””â”€â”€ README.md            # é¡¹ç›®æ–‡æ¡£
```

## âš™ï¸ é…ç½®è¯´æ˜

ç¼–è¾‘ `config.yaml` æ–‡ä»¶ï¼š

```yaml
API_KEY: your_qweather_api_key  # å’Œé£å¤©æ°”APIå¯†é’¥
times: 3                        # å¤©æ°”æ£€æŸ¥é—´éš”ï¼ˆåˆ†é’Ÿï¼‰
```

### è·å–å¤©æ°”APIå¯†é’¥

1. è®¿é—® [å’Œé£å¤©æ°”å¼€å‘è€…å¹³å°](https://dev.qweather.com/)
2. æ³¨å†Œè´¦å·å¹¶åˆ›å»ºåº”ç”¨
3. è·å–API Keyå¹¶é…ç½®åˆ°config.yaml
4. å¦‚éœ€æ›´æ”¹åŸå¸‚ï¼Œè¯·æ›´æ”¹[app.py](app.py)ç¬¬98è¡Œ ``        url = f"https://devapi.qweather.com/v7/weather/now?location=101240310&key={config['API_KEY']}"``ä¸­çš„locationï¼Œä½ç½®ä»£ç å‚è€ƒï¼»å®˜æ–¹çš„ä½ç½®ä»£ç ä»“åº“ï¼½(https://github.com/qwd/LocationList)

## ğŸŒ å¤–ç½‘è®¿é—®

### ä½¿ç”¨ Cloudflare Tunnel

1. å®‰è£… Cloudflare Tunnel
   ```bash
   brew install cloudflared
   ```

2. ç™»å½• Cloudflare
   ```bash
   cloudflared tunnel login
   ```

3. åˆ›å»ºéš§é“
   ```bash
   cloudflared tunnel create rainmail
   ```

4. é…ç½®è·¯ç”±
   ```bash
   cloudflared tunnel route dns rainmail your-domain.example.com
   ```

5. å¯åŠ¨éš§é“
   ```bash
   cloudflared tunnel run rainmail
   ```

### ä½¿ç”¨ cpolar

1. å®‰è£… cpolar
   ```bash
   brew install cpolar
   ```

2. å¯åŠ¨å†…ç½‘ç©¿é€
   ```bash
   cpolar http 5000
   ```

## ğŸ§ª æµ‹è¯•éªŒè¯

è¿è¡ŒåŠŸèƒ½æµ‹è¯•ï¼š

```bash
python test_app.py
```

æµ‹è¯•å†…å®¹åŒ…æ‹¬ï¼š
- å¤©æ°”åŒæ­¥åŠŸèƒ½
- æ•°æ®éš”ç¦»ä¿æŠ¤
- æ¶ˆæ¯æäº¤åŠŸèƒ½
- XSSé˜²æŠ¤éªŒè¯
- å¥åº·æ£€æŸ¥æ¥å£

## ğŸ”§ APIæ¥å£

### è·å–å¤©æ°”çŠ¶æ€
```
GET /api/weather
è¿”å›: {"weather_status": "sunny"|"rainy"}
```

### æ¶ˆæ¯ç®¡ç†
```
GET /api/messages        # è·å–æ¶ˆæ¯åˆ—è¡¨ï¼ˆä»…é›¨å¤©ï¼‰
POST /api/messages       # æäº¤æ–°æ¶ˆæ¯
Body: {"content": "æ¶ˆæ¯å†…å®¹"}
```

### å¥åº·æ£€æŸ¥
```
GET /api/health
è¿”å›: {"status": "healthy", "timestamp": "ISOæ—¶é—´"}
```

## ğŸ¨ ç•Œé¢é¢„è§ˆ

- **æ™´å¤©æ¨¡å¼**ï¼šæµ…è‰²èƒŒæ™¯ï¼Œäº‘é›¾åŠ¨æ•ˆï¼Œåªèƒ½æŠ•é€’
- **é›¨å¤©æ¨¡å¼**ï¼šæ·±è‰²èƒŒæ™¯ï¼Œé›¨æ»´åŠ¨æ•ˆï¼Œå¯æŸ¥çœ‹æ‰€æœ‰ç§˜å¯†
- **å“åº”å¼è®¾è®¡**ï¼šæ”¯æŒç§»åŠ¨ç«¯å’Œæ¡Œé¢ç«¯
- **æ¯›ç»ç’ƒæ•ˆæœ**ï¼šç°ä»£åŒ–ç»ç’ƒå½¢æ€è®¾è®¡

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

- å•æœºæ”¯æŒ50+å¹¶å‘ç”¨æˆ·
- å¤©æ°”çŠ¶æ€æ¯2åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡
- å‰ç«¯æ¯10ç§’æ£€æŸ¥å¤©æ°”çŠ¶æ€
- SQLiteæ•°æ®åº“ï¼Œè½»é‡é«˜æ•ˆ

## ğŸ”’ å®‰å…¨ç‰¹æ€§

- XSSè¾“å…¥è¿‡æ»¤
- SQLæ³¨å…¥é˜²æŠ¤
- å¤©æ°”APIè¯·æ±‚è¶…æ—¶å¤„ç†
- é”™è¯¯çŠ¶æ€ç¼“å­˜æœºåˆ¶

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **å¤©æ°”APIè¯·æ±‚å¤±è´¥**
   - æ£€æŸ¥ç½‘ç»œè¿æ¥
   - éªŒè¯APIå¯†é’¥é…ç½®

2. **æ•°æ®åº“åˆå§‹åŒ–å¤±è´¥**
   - æ£€æŸ¥æ–‡ä»¶å†™å…¥æƒé™
   - ç¡®è®¤SQLiteæ”¯æŒ

3. **ç«¯å£å ç”¨**
   - æ›´æ¢ç«¯å£ï¼š`app.run(port=5001)`

### æ—¥å¿—æŸ¥çœ‹

åº”ç”¨æ—¥å¿—è¾“å‡ºåœ¨æ§åˆ¶å°ï¼ŒåŒ…å«ï¼š
- å¤©æ°”APIè°ƒç”¨çŠ¶æ€
- æ•°æ®åº“æ“ä½œè®°å½•
- é”™è¯¯å¼‚å¸¸ä¿¡æ¯

## ğŸ“„ è®¸å¯è¯

MIT License


---

*è®©é›¨æ°´æ»‹æ¶¦ç§˜å¯†çš„ç”Ÿé•¿ï¼Œè®©é˜³å…‰å®ˆæŠ¤å†…å¿ƒçš„å®é™ã€‚*